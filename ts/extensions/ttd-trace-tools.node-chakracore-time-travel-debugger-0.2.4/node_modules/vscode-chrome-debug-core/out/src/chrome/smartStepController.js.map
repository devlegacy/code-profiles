{"version":3,"sources":["src/chrome/smartStepController.ts"],"names":[],"mappings":";AAAA;;2DAE2D;;;;;;;;;;AAO3D,6DAA6C;AAE7C;IAII,YACI,gBAAoC,EAC5B,mBAAuC,EACvC,gBAAqC,EACrC,qBAA+C;QAF/C,wBAAmB,GAAnB,mBAAmB,CAAoB;QACvC,qBAAgB,GAAhB,gBAAgB,CAAqB;QACrC,0BAAqB,GAArB,qBAAqB,CAA0B;QANnD,oBAAe,GAAG,CAAC,CAAC;QAQxB,IAAI,CAAC,iBAAiB,GAAG,gBAAgB,CAAC,SAAS,CAAC;IACxD,CAAC;IAED,IAAW,gBAAgB;QACvB,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC;IAClC,CAAC;IAEM,eAAe;QAClB,IAAI,CAAC,iBAAiB,GAAG,CAAC,IAAI,CAAC,iBAAiB,CAAC;IACrD,CAAC;IAED;;OAEG;IACU,cAAc,CAAC,KAA8B;;YACtD,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC;YACjD,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBACT,IAAI,CAAC,eAAe,EAAE,CAAC;gBACvB,MAAM,IAAI,CAAC,mBAAmB,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC7C,MAAM,CAAC,IAAI,CAAC;YAChB,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC,CAAC,CAAC;oBAC3B,4BAAM,CAAC,GAAG,CAAC,sBAAsB,IAAI,CAAC,eAAe,QAAQ,CAAC,CAAC;oBAC/D,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;gBAC7B,CAAC;gBAED,MAAM,CAAC,KAAK,CAAC;YACjB,CAAC;QACL,CAAC;KAAA;IAEa,eAAe,CAAC,KAA8B;;YACxD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC;gBAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;YAE3D,MAAM,UAAU,GAAG,IAAI,CAAC,mBAAmB,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;YACzE,MAAM,UAAU,GAAG,IAAI,CAAC,gBAAgB,CAAC,2BAA2B,CAAC,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC,IAAI,CAAC;YACvH,MAAM,OAAO,GAAG,MAAM,IAAI,CAAC,qBAAqB,CAAC,aAAa,CAAC,UAAU,EAAE,KAAK,CAAC,QAAQ,CAAC,UAAU,EAAE,KAAK,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;YAEnI,MAAM,CAAC,CAAC,OAAO,CAAC;QACpB,CAAC;KAAA;CAEJ;AAlDD,kDAkDC","file":"smartStepController.js","sourcesContent":["/*---------------------------------------------------------\n* Copyright (C) Microsoft Corporation. All rights reserved.\n*--------------------------------------------------------*/\n\nimport { ICommonRequestArgs } from '../debugAdapterInterfaces';\nimport Crdp from '../../crdp/crdp';\nimport { ChromeDebugAdapter } from './chromeDebugAdapter';\nimport { BasePathTransformer } from '../transformers/basePathTransformer';\nimport { BaseSourceMapTransformer } from '../transformers/baseSourceMapTransformer';\nimport { logger } from 'vscode-debugadapter';\n\nexport class SmartStepController {\n    private _smartStepEnabled: boolean;\n    private _smartStepCount = 0;\n\n    constructor(\n        launchAttachArgs: ICommonRequestArgs,\n        private _chromeDebugAdapter: ChromeDebugAdapter,\n        private _pathTransformer: BasePathTransformer,\n        private _sourceMapTransformer: BaseSourceMapTransformer)\n    {\n        this._smartStepEnabled = launchAttachArgs.smartStep;\n    }\n\n    public get smartStepEnabled(): boolean {\n        return this._smartStepEnabled;\n    }\n\n    public toggleSmartStep(): void {\n        this._smartStepEnabled = !this._smartStepEnabled;\n    }\n\n    /**\n     * SmartSteps through the give frame if needed. Returns whether a smartStep happened.\n     */\n    public async maybeSmartStep(frame: Crdp.Debugger.CallFrame): Promise<boolean> {\n        const should = await this.shouldSmartStep(frame);\n        if (should) {\n            this._smartStepCount++;\n            await this._chromeDebugAdapter.stepIn(false);\n            return true;\n        } else {\n            if (this._smartStepCount > 0) {\n                logger.log(`SmartStep: Skipped ${this._smartStepCount} steps`);\n                this._smartStepCount = 0;\n            }\n\n            return false;\n        }\n    }\n\n    private async shouldSmartStep(frame: Crdp.Debugger.CallFrame): Promise<boolean> {\n        if (!this._smartStepEnabled) return Promise.resolve(false);\n\n        const stackFrame = this._chromeDebugAdapter.callFrameToStackFrame(frame);\n        const clientPath = this._pathTransformer.getClientPathFromTargetPath(stackFrame.source.path) || stackFrame.source.path;\n        const mapping = await this._sourceMapTransformer.mapToAuthored(clientPath, frame.location.lineNumber, frame.location.columnNumber);\n\n        return !mapping;\n    }\n\n}"],"sourceRoot":"../../.."}