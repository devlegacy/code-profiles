{"version":3,"sources":["../src/chrome/variables/variableContainers.ts"],"names":[],"mappings":"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","file":"variableContainers.js","sourcesContent":["/*---------------------------------------------------------\n * Copyright (C) Microsoft Corporation. All rights reserved.\n *--------------------------------------------------------*/\n\nimport { DebugProtocol } from 'vscode-debugprotocol';\n\nimport Crdp from '../../../crdp/crdp';\nimport * as utils from '../../utils';\nimport * as chromeUtils from '../chromeUtils';\nimport * as errors from '../../errors';\nimport { VariablesService } from './variables';\n\nexport interface IVariableContainer {\n    expand(filter?: string, start?: number, count?: number): Promise<DebugProtocol.Variable[]>;\n    setValue(name: string, value: string): Promise<string>;\n}\n\nexport abstract class BaseVariableContainer implements IVariableContainer {\n    constructor(protected varsService: VariablesService, protected objectId: string, protected evaluateName?: string) {\n    }\n\n    public expand(filter?: string, start?: number, count?: number): Promise<DebugProtocol.Variable[]> {\n        return this.varsService.getVariablesForObjectId(this.objectId, this.evaluateName, filter, start, count);\n    }\n\n    public setValue(name: string, value: string): Promise<string> {\n        return utils.errP('setValue not supported by this variable type');\n    }\n}\n\nexport class PropertyContainer extends BaseVariableContainer {\n    public setValue(name: string, value: string): Promise<string> {\n        return this.setPropertyValue(this.objectId, name, value);\n    }\n\n    private async setPropertyValue(objectId: string, propName: string, value: string): Promise<string> {\n        const setPropertyValueFn = `function() { return this[\"${propName}\"] = ${value} }`;\n\n        const response = await this.varsService.chrome.Runtime.callFunctionOn({\n            objectId, functionDeclaration: setPropertyValueFn,\n            silent: true\n        }).catch(error => Promise.reject(errors.errorFromEvaluate(error.message)));\n\n        if (response.exceptionDetails) {\n            const errMsg = chromeUtils.errorMessageFromExceptionDetails(response.exceptionDetails);\n            return Promise.reject<string>(errors.errorFromEvaluate(errMsg));\n        } else {\n            // Temporary, Microsoft/vscode#12019\n            return chromeUtils.remoteObjectToValue(response.result).value;\n        }\n    }\n\n}\n\nexport class LoggedObjectsContainer extends BaseVariableContainer {\n    constructor(variablesController: VariablesService, private args: Crdp.Runtime.RemoteObject[]) {\n        super(variablesController, undefined);\n    }\n\n    public expand(filter?: string, start?: number, count?: number): Promise<DebugProtocol.Variable[]> {\n        return Promise.all(this.args.map((arg, i) => this.varsService.remoteObjectToVariable('' + i, arg, undefined, /*stringify=*/false, 'repl')));\n    }\n}\n\nexport class ScopeContainer extends BaseVariableContainer {\n    private _thisObj: Crdp.Runtime.RemoteObject;\n    private _returnValue: Crdp.Runtime.RemoteObject;\n    private _frameId: string;\n    private _origScopeIndex: number;\n\n    public constructor(varsService: VariablesService, frameId: string, origScopeIndex: number, objectId: string, thisObj?: Crdp.Runtime.RemoteObject, returnValue?: Crdp.Runtime.RemoteObject) {\n        super(varsService, objectId, '');\n        this._thisObj = thisObj;\n        this._returnValue = returnValue;\n        this._frameId = frameId;\n        this._origScopeIndex = origScopeIndex;\n    }\n\n    /**\n     * Call super then insert the 'this' object if needed\n     */\n    public expand(filter?: string, start?: number, count?: number): Promise<DebugProtocol.Variable[]> {\n        // No filtering in scopes right now\n        return super.expand('all', start, count).then(variables => {\n            if (this._thisObj) {\n                // If this is a scope that should have the 'this', prop, insert it at the top of the list\n                return this.insertRemoteObject(variables, 'this', this._thisObj);\n            }\n\n            return variables;\n        }).then(variables => {\n            if (this._returnValue) {\n                return this.insertRemoteObject(variables, 'Return value', this._returnValue);\n            }\n\n            return variables;\n        });\n    }\n\n    public setValue(name: string, value: string): Promise<string> {\n        return this.varsService.setVariableValue(this._frameId, this._origScopeIndex, name, value);\n    }\n\n    private insertRemoteObject(variables: DebugProtocol.Variable[], name: string, obj: Crdp.Runtime.RemoteObject): Promise<DebugProtocol.Variable[]> {\n        return this.varsService.remoteObjectToVariable(name, obj).then(variable => {\n            variables.unshift(variable);\n            return variables;\n        });\n    }\n}\n\nexport class ExceptionContainer extends PropertyContainer {\n    protected _exception: Crdp.Runtime.RemoteObject;\n\n    protected constructor(adapter: VariablesService, objectId: string, exception: Crdp.Runtime.RemoteObject) {\n        super(adapter, exception.objectId, undefined);\n        this._exception = exception;\n    }\n\n    /**\n     * Expand the exception as if it were a Scope\n     */\n    public static create(adapter: VariablesService, exception: Crdp.Runtime.RemoteObject): ExceptionContainer {\n        return exception.objectId ?\n            new ExceptionContainer(adapter, exception.objectId, exception) :\n            new ExceptionValueContainer(adapter, exception);\n    }\n}\n\n/**\n * For when a value is thrown instead of an object\n */\nexport class ExceptionValueContainer extends ExceptionContainer {\n    public constructor(variablesController: VariablesService, exception: Crdp.Runtime.RemoteObject) {\n        super(variablesController, 'EXCEPTION_ID', exception);\n    }\n\n    /**\n     * Make up a fake 'Exception' property to hold the thrown value, displayed under the Exception Scope\n     */\n    public expand(filter?: string, start?: number, count?: number): Promise<DebugProtocol.Variable[]> {\n        const excValuePropDescriptor: Crdp.Runtime.PropertyDescriptor = <any>{ name: 'Exception', value: this._exception };\n        return this.varsService.propertyDescriptorToVariable(excValuePropDescriptor)\n            .then(variable => [variable]);\n    }\n}\n"],"sourceRoot":"../../.."}