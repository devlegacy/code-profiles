(()=>{var ot={993:l=>{"use strict";var y={};l.exports=y;function E(f){return f<0?-1:1}function b(f){return f%1===.5&&(f&1)===0?Math.floor(f):Math.round(f)}function A(f,a){a.unsigned||--f;const x=a.unsigned?0:-Math.pow(2,f),p=Math.pow(2,f)-1,g=a.moduloBitLength?Math.pow(2,a.moduloBitLength):Math.pow(2,f),U=a.moduloBitLength?Math.pow(2,a.moduloBitLength-1):Math.pow(2,f-1);return function(J,B){B||(B={});let _=+J;if(B.enforceRange){if(!Number.isFinite(_))throw new TypeError("Argument is not a finite number");if(_=E(_)*Math.floor(Math.abs(_)),_<x||_>p)throw new TypeError("Argument is not in byte range");return _}if(!isNaN(_)&&B.clamp)return _=b(_),_<x&&(_=x),_>p&&(_=p),_;if(!Number.isFinite(_)||_===0)return 0;if(_=E(_)*Math.floor(Math.abs(_)),_=_%g,!a.unsigned&&_>=U)return _-g;if(a.unsigned){if(_<0)_+=g;else if(_===-0)return 0}return _}}y.void=function(){},y.boolean=function(f){return!!f},y.byte=A(8,{unsigned:!1}),y.octet=A(8,{unsigned:!0}),y.short=A(16,{unsigned:!1}),y["unsigned short"]=A(16,{unsigned:!0}),y.long=A(32,{unsigned:!1}),y["unsigned long"]=A(32,{unsigned:!0}),y["long long"]=A(32,{unsigned:!1,moduloBitLength:64}),y["unsigned long long"]=A(32,{unsigned:!0,moduloBitLength:64}),y.double=function(f){const a=+f;if(!Number.isFinite(a))throw new TypeError("Argument is not a finite floating-point value");return a},y["unrestricted double"]=function(f){const a=+f;if(isNaN(a))throw new TypeError("Argument is NaN");return a},y.float=y.double,y["unrestricted float"]=y["unrestricted double"],y.DOMString=function(f,a){return a||(a={}),a.treatNullAsEmptyString&&f===null?"":String(f)},y.ByteString=function(f,a){const x=String(f);let p;for(let g=0;(p=x.codePointAt(g))!==void 0;++g)if(p>255)throw new TypeError("Argument is not a valid bytestring");return x},y.USVString=function(f){const a=String(f),x=a.length,p=[];for(let g=0;g<x;++g){const U=a.charCodeAt(g);if(U<55296||U>57343)p.push(String.fromCodePoint(U));else if(56320<=U&&U<=57343)p.push(String.fromCodePoint(65533));else if(g===x-1)p.push(String.fromCodePoint(65533));else{const J=a.charCodeAt(g+1);if(56320<=J&&J<=57343){const B=U&1023,_=J&1023;p.push(String.fromCodePoint(65536+1024*B+_)),++g}else p.push(String.fromCodePoint(65533))}}return p.join("")},y.Date=function(f,a){if(!(f instanceof Date))throw new TypeError("Argument is not a Date object");if(!isNaN(f))return f},y.RegExp=function(f,a){return f instanceof RegExp||(f=new RegExp(f)),f}},718:(l,y,E)=>{"use strict";const b=E(341);y.implementation=class{constructor(f){const a=f[0],x=f[1];let p=null;if(x!==void 0&&(p=b.basicURLParse(x),p==="failure"))throw new TypeError("Invalid base URL");const g=b.basicURLParse(a,{baseURL:p});if(g==="failure")throw new TypeError("Invalid URL");this._url=g}get href(){return b.serializeURL(this._url)}set href(f){const a=b.basicURLParse(f);if(a==="failure")throw new TypeError("Invalid URL");this._url=a}get origin(){return b.serializeURLOrigin(this._url)}get protocol(){return this._url.scheme+":"}set protocol(f){b.basicURLParse(f+":",{url:this._url,stateOverride:"scheme start"})}get username(){return this._url.username}set username(f){b.cannotHaveAUsernamePasswordPort(this._url)||b.setTheUsername(this._url,f)}get password(){return this._url.password}set password(f){b.cannotHaveAUsernamePasswordPort(this._url)||b.setThePassword(this._url,f)}get host(){const f=this._url;return f.host===null?"":f.port===null?b.serializeHost(f.host):b.serializeHost(f.host)+":"+b.serializeInteger(f.port)}set host(f){this._url.cannotBeABaseURL||b.basicURLParse(f,{url:this._url,stateOverride:"host"})}get hostname(){return this._url.host===null?"":b.serializeHost(this._url.host)}set hostname(f){this._url.cannotBeABaseURL||b.basicURLParse(f,{url:this._url,stateOverride:"hostname"})}get port(){return this._url.port===null?"":b.serializeInteger(this._url.port)}set port(f){b.cannotHaveAUsernamePasswordPort(this._url)||(f===""?this._url.port=null:b.basicURLParse(f,{url:this._url,stateOverride:"port"}))}get pathname(){return this._url.cannotBeABaseURL?this._url.path[0]:this._url.path.length===0?"":"/"+this._url.path.join("/")}set pathname(f){this._url.cannotBeABaseURL||(this._url.path=[],b.basicURLParse(f,{url:this._url,stateOverride:"path start"}))}get search(){return this._url.query===null||this._url.query===""?"":"?"+this._url.query}set search(f){const a=this._url;if(f===""){a.query=null;return}const x=f[0]==="?"?f.substring(1):f;a.query="",b.basicURLParse(x,{url:a,stateOverride:"query"})}get hash(){return this._url.fragment===null||this._url.fragment===""?"":"#"+this._url.fragment}set hash(f){if(f===""){this._url.fragment=null;return}const a=f[0]==="#"?f.substring(1):f;this._url.fragment="",b.basicURLParse(a,{url:this._url,stateOverride:"fragment"})}toJSON(){return this.href}}},328:(l,y,E)=>{"use strict";const b=E(993),A=E(581),f=E(718),a=A.implSymbol;function x(p){if(!this||this[a]||!(this instanceof x))throw new TypeError("Failed to construct 'URL': Please use the 'new' operator, this DOM object constructor cannot be called as a function.");if(arguments.length<1)throw new TypeError("Failed to construct 'URL': 1 argument required, but only "+arguments.length+" present.");const g=[];for(let U=0;U<arguments.length&&U<2;++U)g[U]=arguments[U];g[0]=b.USVString(g[0]),g[1]!==void 0&&(g[1]=b.USVString(g[1])),l.exports.setup(this,g)}x.prototype.toJSON=function(){if(!this||!l.exports.is(this))throw new TypeError("Illegal invocation");const g=[];for(let U=0;U<arguments.length&&U<0;++U)g[U]=arguments[U];return this[a].toJSON.apply(this[a],g)},Object.defineProperty(x.prototype,"href",{get(){return this[a].href},set(p){p=b.USVString(p),this[a].href=p},enumerable:!0,configurable:!0}),x.prototype.toString=function(){if(!this||!l.exports.is(this))throw new TypeError("Illegal invocation");return this.href},Object.defineProperty(x.prototype,"origin",{get(){return this[a].origin},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"protocol",{get(){return this[a].protocol},set(p){p=b.USVString(p),this[a].protocol=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"username",{get(){return this[a].username},set(p){p=b.USVString(p),this[a].username=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"password",{get(){return this[a].password},set(p){p=b.USVString(p),this[a].password=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"host",{get(){return this[a].host},set(p){p=b.USVString(p),this[a].host=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"hostname",{get(){return this[a].hostname},set(p){p=b.USVString(p),this[a].hostname=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"port",{get(){return this[a].port},set(p){p=b.USVString(p),this[a].port=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"pathname",{get(){return this[a].pathname},set(p){p=b.USVString(p),this[a].pathname=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"search",{get(){return this[a].search},set(p){p=b.USVString(p),this[a].search=p},enumerable:!0,configurable:!0}),Object.defineProperty(x.prototype,"hash",{get(){return this[a].hash},set(p){p=b.USVString(p),this[a].hash=p},enumerable:!0,configurable:!0}),l.exports={is(p){return!!p&&p[a]instanceof f.implementation},create(p,g){let U=Object.create(x.prototype);return this.setup(U,p,g),U},setup(p,g,U){U||(U={}),U.wrapper=p,p[a]=new f.implementation(g,U),p[a][A.wrapperSymbol]=p},interface:x,expose:{Window:{URL:x},Worker:{URL:x}}}},347:(l,y,E)=>{"use strict";y.URL=E(328).interface,E(341).serializeURL,E(341).serializeURLOrigin,E(341).basicURLParse,E(341).setTheUsername,E(341).setThePassword,E(341).serializeHost,E(341).serializeInteger,E(341).parseURL},341:(l,y,E)=>{"use strict";const b=E(477),A=E(691),f={ftp:21,file:null,gopher:70,http:80,https:443,ws:80,wss:443},a=Symbol("failure");function x(s){return b.ucs2.decode(s).length}function p(s,i){const u=s[i];return isNaN(u)?void 0:String.fromCodePoint(u)}function g(s){return s>=48&&s<=57}function U(s){return s>=65&&s<=90||s>=97&&s<=122}function J(s){return U(s)||g(s)}function B(s){return g(s)||s>=65&&s<=70||s>=97&&s<=102}function _(s){return s==="."||s.toLowerCase()==="%2e"}function Ne(s){return s=s.toLowerCase(),s===".."||s==="%2e."||s===".%2e"||s==="%2e%2e"}function Ie(s,i){return U(s)&&(i===58||i===124)}function ae(s){return s.length===2&&U(s.codePointAt(0))&&(s[1]===":"||s[1]==="|")}function H(s){return s.length===2&&U(s.codePointAt(0))&&s[1]===":"}function ke(s){return s.search(/\u0000|\u0009|\u000A|\u000D|\u0020|#|%|\/|:|\?|@|\[|\\|\]/)!==-1}function fe(s){return s.search(/\u0000|\u0009|\u000A|\u000D|\u0020|#|\/|:|\?|@|\[|\\|\]/)!==-1}function be(s){return f[s]!==void 0}function T(s){return be(s.scheme)}function V(s){return f[s]}function O(s){let i=s.toString(16).toUpperCase();return i.length===1&&(i="0"+i),"%"+i}function _e(s){const i=new Buffer(s);let u="";for(let h=0;h<i.length;++h)u+=O(i[h]);return u}function Fe(s){const i=new Buffer(s),u=[];for(let h=0;h<i.length;++h)i[h]!==37?u.push(i[h]):i[h]===37&&B(i[h+1])&&B(i[h+2])?(u.push(parseInt(i.slice(h+1,h+3).toString(),16)),h+=2):u.push(i[h]);return new Buffer(u).toString()}function ce(s){return s<=31||s>126}const ye=new Set([32,34,35,60,62,63,96,123,125]);function we(s){return ce(s)||ye.has(s)}const De=new Set([47,58,59,61,64,91,92,93,94,124]);function ue(s){return we(s)||De.has(s)}function K(s,i){const u=String.fromCodePoint(s);return i(s)?_e(u):u}function le(s){let i=10;return s.length>=2&&s.charAt(0)==="0"&&s.charAt(1).toLowerCase()==="x"?(s=s.substring(2),i=16):s.length>=2&&s.charAt(0)==="0"&&(s=s.substring(1),i=8),s===""?0:(i===10?/[^0-9]/:i===16?/[^0-9A-Fa-f]/:/[^0-7]/).test(s)?a:parseInt(s,i)}function k(s){const i=s.split(".");if(i[i.length-1]===""&&i.length>1&&i.pop(),i.length>4)return s;const u=[];for(const P of i){if(P==="")return s;const L=le(P);if(L===a)return s;u.push(L)}for(let P=0;P<u.length-1;++P)if(u[P]>255)return a;if(u[u.length-1]>=Math.pow(256,5-u.length))return a;let h=u.pop(),d=0;for(const P of u)h+=P*Math.pow(256,3-d),++d;return h}function Oe(s){let i="",u=s;for(let h=1;h<=4;++h)i=String(u%256)+i,h!==4&&(i="."+i),u=Math.floor(u/256);return i}function pe(s){const i=[0,0,0,0,0,0,0,0];let u=0,h=null,d=0;if(s=b.ucs2.decode(s),s[d]===58){if(s[d+1]!==58)return a;d+=2,++u,h=u}for(;d<s.length;){if(u===8)return a;if(s[d]===58){if(h!==null)return a;++d,++u,h=u;continue}let P=0,L=0;for(;L<4&&B(s[d]);)P=P*16+parseInt(p(s,d),16),++d,++L;if(s[d]===46){if(L===0||(d-=L,u>6))return a;let I=0;for(;s[d]!==void 0;){let D=null;if(I>0)if(s[d]===46&&I<4)++d;else return a;if(!g(s[d]))return a;for(;g(s[d]);){const Y=parseInt(p(s,d));if(D===null)D=Y;else{if(D===0)return a;D=D*10+Y}if(D>255)return a;++d}i[u]=i[u]*256+D,++I,(I===2||I===4)&&++u}if(I!==4)return a;break}else if(s[d]===58){if(++d,s[d]===void 0)return a}else if(s[d]!==void 0)return a;i[u]=P,++u}if(h!==null){let P=u-h;for(u=7;u!==0&&P>0;){const L=i[h+P-1];i[h+P-1]=i[u],i[u]=L,--u,--P}}else if(h===null&&u!==8)return a;return i}function Ce(s){let i="";const h=ze(s).idx;let d=!1;for(let P=0;P<=7;++P)if(!(d&&s[P]===0)){if(d&&(d=!1),h===P){i+=P===0?"::":":",d=!0;continue}i+=s[P].toString(16),P!==7&&(i+=":")}return i}function Se(s,i){if(s[0]==="[")return s[s.length-1]!=="]"?a:pe(s.substring(1,s.length-1));if(!i)return Z(s);const u=Fe(s),h=A.toASCII(u,!1,A.PROCESSING_OPTIONS.NONTRANSITIONAL,!1);if(h===null||ke(h))return a;const d=k(h);return typeof d=="number"||d===a?d:h}function Z(s){if(fe(s))return a;let i="";const u=b.ucs2.decode(s);for(let h=0;h<u.length;++h)i+=K(u[h],ce);return i}function ze(s){let i=null,u=1,h=null,d=0;for(let P=0;P<s.length;++P)s[P]!==0?(d>u&&(i=h,u=d),h=null,d=0):(h===null&&(h=P),++d);return d>u&&(i=h,u=d),{idx:i,len:u}}function F(s){return typeof s=="number"?Oe(s):s instanceof Array?"["+Ce(s)+"]":s}function ve(s){return s.replace(/^[\u0000-\u001F\u0020]+|[\u0000-\u001F\u0020]+$/g,"")}function ee(s){return s.replace(/\u0009|\u000A|\u000D/g,"")}function $(s){const i=s.path;i.length!==0&&(s.scheme==="file"&&i.length===1&&Ae(i[0])||i.pop())}function de(s){return s.username!==""||s.password!==""}function q(s){return s.host===null||s.host===""||s.cannotBeABaseURL||s.scheme==="file"}function Ae(s){return/^[A-Za-z]:$/.test(s)}function v(s,i,u,h,d){if(this.pointer=0,this.input=s,this.base=i||null,this.encodingOverride=u||"utf-8",this.stateOverride=d,this.url=h,this.failure=!1,this.parseError=!1,!this.url){this.url={scheme:"",username:"",password:"",host:null,port:null,path:[],query:null,fragment:null,cannotBeABaseURL:!1};const L=ve(this.input);L!==this.input&&(this.parseError=!0),this.input=L}const P=ee(this.input);for(P!==this.input&&(this.parseError=!0),this.input=P,this.state=d||"scheme start",this.buffer="",this.atFlag=!1,this.arrFlag=!1,this.passwordTokenSeenFlag=!1,this.input=b.ucs2.decode(this.input);this.pointer<=this.input.length;++this.pointer){const L=this.input[this.pointer],I=isNaN(L)?void 0:String.fromCodePoint(L),D=this["parse "+this.state](L,I);if(D){if(D===a){this.failure=!0;break}}else break}}v.prototype["parse scheme start"]=function(i,u){if(U(i))this.buffer+=u.toLowerCase(),this.state="scheme";else if(!this.stateOverride)this.state="no scheme",--this.pointer;else return this.parseError=!0,a;return!0},v.prototype["parse scheme"]=function(i,u){if(J(i)||i===43||i===45||i===46)this.buffer+=u.toLowerCase();else if(i===58){if(this.stateOverride&&(T(this.url)&&!be(this.buffer)||!T(this.url)&&be(this.buffer)||(de(this.url)||this.url.port!==null)&&this.buffer==="file"||this.url.scheme==="file"&&(this.url.host===""||this.url.host===null))||(this.url.scheme=this.buffer,this.buffer="",this.stateOverride))return!1;this.url.scheme==="file"?((this.input[this.pointer+1]!==47||this.input[this.pointer+2]!==47)&&(this.parseError=!0),this.state="file"):T(this.url)&&this.base!==null&&this.base.scheme===this.url.scheme?this.state="special relative or authority":T(this.url)?this.state="special authority slashes":this.input[this.pointer+1]===47?(this.state="path or authority",++this.pointer):(this.url.cannotBeABaseURL=!0,this.url.path.push(""),this.state="cannot-be-a-base-URL path")}else if(!this.stateOverride)this.buffer="",this.state="no scheme",this.pointer=-1;else return this.parseError=!0,a;return!0},v.prototype["parse no scheme"]=function(i){return this.base===null||this.base.cannotBeABaseURL&&i!==35?a:(this.base.cannotBeABaseURL&&i===35?(this.url.scheme=this.base.scheme,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.url.cannotBeABaseURL=!0,this.state="fragment"):this.base.scheme==="file"?(this.state="file",--this.pointer):(this.state="relative",--this.pointer),!0)},v.prototype["parse special relative or authority"]=function(i){return i===47&&this.input[this.pointer+1]===47?(this.state="special authority ignore slashes",++this.pointer):(this.parseError=!0,this.state="relative",--this.pointer),!0},v.prototype["parse path or authority"]=function(i){return i===47?this.state="authority":(this.state="path",--this.pointer),!0},v.prototype["parse relative"]=function(i){return this.url.scheme=this.base.scheme,isNaN(i)?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query=this.base.query):i===47?this.state="relative slash":i===63?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query="",this.state="query"):i===35?(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.state="fragment"):T(this.url)&&i===92?(this.parseError=!0,this.state="relative slash"):(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.url.path=this.base.path.slice(0,this.base.path.length-1),this.state="path",--this.pointer),!0},v.prototype["parse relative slash"]=function(i){return T(this.url)&&(i===47||i===92)?(i===92&&(this.parseError=!0),this.state="special authority ignore slashes"):i===47?this.state="authority":(this.url.username=this.base.username,this.url.password=this.base.password,this.url.host=this.base.host,this.url.port=this.base.port,this.state="path",--this.pointer),!0},v.prototype["parse special authority slashes"]=function(i){return i===47&&this.input[this.pointer+1]===47?(this.state="special authority ignore slashes",++this.pointer):(this.parseError=!0,this.state="special authority ignore slashes",--this.pointer),!0},v.prototype["parse special authority ignore slashes"]=function(i){return i!==47&&i!==92?(this.state="authority",--this.pointer):this.parseError=!0,!0},v.prototype["parse authority"]=function(i,u){if(i===64){this.parseError=!0,this.atFlag&&(this.buffer="%40"+this.buffer),this.atFlag=!0;const h=x(this.buffer);for(let d=0;d<h;++d){const P=this.buffer.codePointAt(d);if(P===58&&!this.passwordTokenSeenFlag){this.passwordTokenSeenFlag=!0;continue}const L=K(P,ue);this.passwordTokenSeenFlag?this.url.password+=L:this.url.username+=L}this.buffer=""}else if(isNaN(i)||i===47||i===63||i===35||T(this.url)&&i===92){if(this.atFlag&&this.buffer==="")return this.parseError=!0,a;this.pointer-=x(this.buffer)+1,this.buffer="",this.state="host"}else this.buffer+=u;return!0},v.prototype["parse hostname"]=v.prototype["parse host"]=function(i,u){if(this.stateOverride&&this.url.scheme==="file")--this.pointer,this.state="file host";else if(i===58&&!this.arrFlag){if(this.buffer==="")return this.parseError=!0,a;const h=Se(this.buffer,T(this.url));if(h===a)return a;if(this.url.host=h,this.buffer="",this.state="port",this.stateOverride==="hostname")return!1}else if(isNaN(i)||i===47||i===63||i===35||T(this.url)&&i===92){if(--this.pointer,T(this.url)&&this.buffer==="")return this.parseError=!0,a;if(this.stateOverride&&this.buffer===""&&(de(this.url)||this.url.port!==null))return this.parseError=!0,!1;const h=Se(this.buffer,T(this.url));if(h===a)return a;if(this.url.host=h,this.buffer="",this.state="path start",this.stateOverride)return!1}else i===91?this.arrFlag=!0:i===93&&(this.arrFlag=!1),this.buffer+=u;return!0},v.prototype["parse port"]=function(i,u){if(g(i))this.buffer+=u;else if(isNaN(i)||i===47||i===63||i===35||T(this.url)&&i===92||this.stateOverride){if(this.buffer!==""){const h=parseInt(this.buffer);if(h>Math.pow(2,16)-1)return this.parseError=!0,a;this.url.port=h===V(this.url.scheme)?null:h,this.buffer=""}if(this.stateOverride)return!1;this.state="path start",--this.pointer}else return this.parseError=!0,a;return!0};const te=new Set([47,92,63,35]);v.prototype["parse file"]=function(i){return this.url.scheme="file",i===47||i===92?(i===92&&(this.parseError=!0),this.state="file slash"):this.base!==null&&this.base.scheme==="file"?isNaN(i)?(this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query=this.base.query):i===63?(this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query="",this.state="query"):i===35?(this.url.host=this.base.host,this.url.path=this.base.path.slice(),this.url.query=this.base.query,this.url.fragment="",this.state="fragment"):(this.input.length-this.pointer-1===0||!Ie(i,this.input[this.pointer+1])||this.input.length-this.pointer-1>=2&&!te.has(this.input[this.pointer+2])?(this.url.host=this.base.host,this.url.path=this.base.path.slice(),$(this.url)):this.parseError=!0,this.state="path",--this.pointer):(this.state="path",--this.pointer),!0},v.prototype["parse file slash"]=function(i){return i===47||i===92?(i===92&&(this.parseError=!0),this.state="file host"):(this.base!==null&&this.base.scheme==="file"&&(H(this.base.path[0])?this.url.path.push(this.base.path[0]):this.url.host=this.base.host),this.state="path",--this.pointer),!0},v.prototype["parse file host"]=function(i,u){if(isNaN(i)||i===47||i===92||i===63||i===35)if(--this.pointer,!this.stateOverride&&ae(this.buffer))this.parseError=!0,this.state="path";else if(this.buffer===""){if(this.url.host="",this.stateOverride)return!1;this.state="path start"}else{let h=Se(this.buffer,T(this.url));if(h===a)return a;if(h==="localhost"&&(h=""),this.url.host=h,this.stateOverride)return!1;this.buffer="",this.state="path start"}else this.buffer+=u;return!0},v.prototype["parse path start"]=function(i){return T(this.url)?(i===92&&(this.parseError=!0),this.state="path",i!==47&&i!==92&&--this.pointer):!this.stateOverride&&i===63?(this.url.query="",this.state="query"):!this.stateOverride&&i===35?(this.url.fragment="",this.state="fragment"):i!==void 0&&(this.state="path",i!==47&&--this.pointer),!0},v.prototype["parse path"]=function(i){if(isNaN(i)||i===47||T(this.url)&&i===92||!this.stateOverride&&(i===63||i===35)){if(T(this.url)&&i===92&&(this.parseError=!0),Ne(this.buffer)?($(this.url),i!==47&&!(T(this.url)&&i===92)&&this.url.path.push("")):_(this.buffer)&&i!==47&&!(T(this.url)&&i===92)?this.url.path.push(""):_(this.buffer)||(this.url.scheme==="file"&&this.url.path.length===0&&ae(this.buffer)&&(this.url.host!==""&&this.url.host!==null&&(this.parseError=!0,this.url.host=""),this.buffer=this.buffer[0]+":"),this.url.path.push(this.buffer)),this.buffer="",this.url.scheme==="file"&&(i===void 0||i===63||i===35))for(;this.url.path.length>1&&this.url.path[0]==="";)this.parseError=!0,this.url.path.shift();i===63&&(this.url.query="",this.state="query"),i===35&&(this.url.fragment="",this.state="fragment")}else i===37&&(!B(this.input[this.pointer+1])||!B(this.input[this.pointer+2]))&&(this.parseError=!0),this.buffer+=K(i,we);return!0},v.prototype["parse cannot-be-a-base-URL path"]=function(i){return i===63?(this.url.query="",this.state="query"):i===35?(this.url.fragment="",this.state="fragment"):(!isNaN(i)&&i!==37&&(this.parseError=!0),i===37&&(!B(this.input[this.pointer+1])||!B(this.input[this.pointer+2]))&&(this.parseError=!0),isNaN(i)||(this.url.path[0]=this.url.path[0]+K(i,ce))),!0},v.prototype["parse query"]=function(i,u){if(isNaN(i)||!this.stateOverride&&i===35){(!T(this.url)||this.url.scheme==="ws"||this.url.scheme==="wss")&&(this.encodingOverride="utf-8");const h=new Buffer(this.buffer);for(let d=0;d<h.length;++d)h[d]<33||h[d]>126||h[d]===34||h[d]===35||h[d]===60||h[d]===62?this.url.query+=O(h[d]):this.url.query+=String.fromCodePoint(h[d]);this.buffer="",i===35&&(this.url.fragment="",this.state="fragment")}else i===37&&(!B(this.input[this.pointer+1])||!B(this.input[this.pointer+2]))&&(this.parseError=!0),this.buffer+=u;return!0},v.prototype["parse fragment"]=function(i){return isNaN(i)||(i===0?this.parseError=!0:(i===37&&(!B(this.input[this.pointer+1])||!B(this.input[this.pointer+2]))&&(this.parseError=!0),this.url.fragment+=K(i,ce))),!0};function je(s,i){let u=s.scheme+":";if(s.host!==null?(u+="//",(s.username!==""||s.password!=="")&&(u+=s.username,s.password!==""&&(u+=":"+s.password),u+="@"),u+=F(s.host),s.port!==null&&(u+=":"+s.port)):s.host===null&&s.scheme==="file"&&(u+="//"),s.cannotBeABaseURL)u+=s.path[0];else for(const h of s.path)u+="/"+h;return s.query!==null&&(u+="?"+s.query),!i&&s.fragment!==null&&(u+="#"+s.fragment),u}function Le(s){let i=s.scheme+"://";return i+=F(s.host),s.port!==null&&(i+=":"+s.port),i}l.exports.serializeURL=je,l.exports.serializeURLOrigin=function(s){switch(s.scheme){case"blob":try{return l.exports.serializeURLOrigin(l.exports.parseURL(s.path[0]))}catch{return"null"}case"ftp":case"gopher":case"http":case"https":case"ws":case"wss":return Le({scheme:s.scheme,host:s.host,port:s.port});case"file":return"file://";default:return"null"}},l.exports.basicURLParse=function(s,i){i===void 0&&(i={});const u=new v(s,i.baseURL,i.encodingOverride,i.url,i.stateOverride);return u.failure?"failure":u.url},l.exports.setTheUsername=function(s,i){s.username="";const u=b.ucs2.decode(i);for(let h=0;h<u.length;++h)s.username+=K(u[h],ue)},l.exports.setThePassword=function(s,i){s.password="";const u=b.ucs2.decode(i);for(let h=0;h<u.length;++h)s.password+=K(u[h],ue)},l.exports.serializeHost=F,l.exports.cannotHaveAUsernamePasswordPort=q,l.exports.serializeInteger=function(s){return String(s)},l.exports.parseURL=function(s,i){return i===void 0&&(i={}),l.exports.basicURLParse(s,{baseURL:i.baseURL,encodingOverride:i.encodingOverride})}},581:l=>{"use strict";l.exports.mixin=function(E,b){const A=Object.getOwnPropertyNames(b);for(let f=0;f<A.length;++f)Object.defineProperty(E,A[f],Object.getOwnPropertyDescriptor(b,A[f]))},l.exports.wrapperSymbol=Symbol("wrapper"),l.exports.implSymbol=Symbol("impl"),l.exports.wrapperForImpl=function(y){return y[l.exports.wrapperSymbol]},l.exports.implForWrapper=function(y){return y[l.exports.implSymbol]}},691:l=>{function y(E){return E}l.exports={toASCII:y}},477:l=>{"use strict";l.exports=require("punycode")}},Xe={};function j(l){var y=Xe[l];if(y!==void 0)return y.exports;var E=Xe[l]={exports:{}};return ot[l](E,E.exports,j),E.exports}j.n=l=>{var y=l&&l.__esModule?()=>l.default:()=>l;return j.d(y,{a:y}),y},j.d=(l,y)=>{for(var E in y)j.o(y,E)&&!j.o(l,E)&&Object.defineProperty(l,E,{enumerable:!0,get:y[E]})},j.o=(l,y)=>Object.prototype.hasOwnProperty.call(l,y),j.r=l=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})};var $e={};(()=>{"use strict";j.r($e),j.d($e,{activate:()=>Ot});const l=require("vscode"),y=require("crypto");var E=j.n(y);const b=new Uint8Array(256);let A=b.length;function f(){return A>b.length-16&&(E().randomFillSync(b),A=0),b.slice(A,A+=16)}const a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function x(t){return typeof t=="string"&&a.test(t)}const p=x,g=[];for(let t=0;t<256;++t)g.push((t+256).toString(16).substr(1));function U(t,e=0){const r=(g[t[e+0]]+g[t[e+1]]+g[t[e+2]]+g[t[e+3]]+"-"+g[t[e+4]]+g[t[e+5]]+"-"+g[t[e+6]]+g[t[e+7]]+"-"+g[t[e+8]]+g[t[e+9]]+"-"+g[t[e+10]]+g[t[e+11]]+g[t[e+12]]+g[t[e+13]]+g[t[e+14]]+g[t[e+15]]).toLowerCase();if(!p(r))throw TypeError("Stringified UUID is invalid");return r}const J=U;function B(t,e,r){t=t||{};const o=t.random||(t.rng||f)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){r=r||0;for(let n=0;n<16;++n)e[r+n]=o[n];return e}return J(o)}const _=B;var Ne=Object.defineProperty,Ie=(t,e,r)=>e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ae=(t,e,r)=>(Ie(t,typeof e!="symbol"?e+"":e,r),r);const H="",ke="GitKraken Authentication",fe="[GitKraken]";var be=(t=>(t.Off="off",t.Error="error",t.Warn="warn",t.Info="info",t.Debug="debug",t))(be||{}),T=(t=>(t[t.Off=0]="Off",t[t.Error=1]="Error",t[t.Warn=2]="Warn",t[t.Info=3]="Info",t[t.Debug=4]="Debug",t))(T||{});const V=class{static configure(t,e){this._isDebugging=t.extensionMode===l.ExtensionMode.Development,this.logLevel=e}static enabled(t){return this.level>=_e(t)}static get isDebugging(){return this._isDebugging}static get logLevel(){return this._logLevel}static set logLevel(t){var e;this._logLevel=t,this.level=_e(t),t==="off"?((e=this.output)==null||e.dispose(),this.output=void 0):this.output=this.output??l.window.createOutputChannel(ke)}static debug(t,...e){this.level<4&&!this.isDebugging||(V.isDebugging&&console.log(this.timestamp,fe,t??H,...e),!(this.output==null||this.level<4)&&this.output.appendLine(`${this.timestamp} ${t??H}${this.toLoggableParams(!0,e)}`))}static error(t,e,...r){if(!(this.level<1&&!this.isDebugging)){if(e===void 0){const o=t instanceof Error?t.stack:void 0;if(o){const n=/.*\s*?at\s(.+?)\s/.exec(o);n!==null&&(e=n[1])}}V.isDebugging&&console.error(this.timestamp,fe,e??H,...r,t),!(this.output==null||this.level<1)&&this.output.appendLine(`${this.timestamp} ${e??H}${this.toLoggableParams(!1,r)}
${String(t)}`)}}static log(t,...e){this.level<3&&!this.isDebugging||(V.isDebugging&&console.log(this.timestamp,fe,t??H,...e),!(this.output==null||this.level<3)&&this.output.appendLine(`${this.timestamp} ${t??H}${this.toLoggableParams(!1,e)}`))}static warn(t,...e){this.level<2&&!this.isDebugging||(V.isDebugging&&console.warn(this.timestamp,fe,t??H,...e),!(this.output==null||this.level<2)&&this.output.appendLine(`${this.timestamp} ${t??H}${this.toLoggableParams(!1,e)}`))}static showOutputChannel(){var t;(t=this.output)==null||t.show()}static toLoggable(t,e){if(typeof t!="object")return String(t);if(t instanceof l.Uri)return`Uri(${t.toString(!0)})`;try{return JSON.stringify(t,e)}catch{return"<error>"}}static get timestamp(){return`[${new Date().toISOString().replace(/T/," ").slice(0,-1)}]`}static toLoggableParams(t,e){if(e.length===0||t&&this.level<4&&!V.isDebugging)return H;const r=e.map(o=>this.toLoggable(o)).join(", ");return r.length!==0?` \u2014 ${r}`:H}};let O=V;ae(O,"output"),ae(O,"_isDebugging"),ae(O,"level",0),ae(O,"_logLevel","off");function _e(t){switch(t){case"off":return 0;case"error":return 1;case"warn":return 2;case"info":return 3;case"debug":return 4;default:return 0}}var Fe=Object.defineProperty,ce=(t,e,r)=>e in t?Fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ye=(t,e,r)=>(ce(t,typeof e!="symbol"?e+"":e,r),r);const we="gitkraken",De="GitKraken",ue=`${we}.auth`;class K{constructor(e,r){this.context=e,this.server=r,ye(this,"_onDidChangeSessions",new l.EventEmitter),ye(this,"_disposable"),ye(this,"_sessionsPromise"),this._sessionsPromise=this.getSessionsFromStorage(),this._disposable=l.Disposable.from(l.authentication.registerAuthenticationProvider(we,De,this,{supportsMultipleAccounts:!1}),this.context.secrets.onDidChange(()=>this.checkForUpdates()))}get onDidChangeSessions(){return this._onDidChangeSessions.event}dispose(){this._disposable.dispose()}async createSession(e){e=e.sort();const r=le(e);O.log(`Creating a session for scopes=${r||"<all>"}...`);try{const o=await this.server.login(e,r),n=await this.createSessionForToken(o,e),c=await this._sessionsPromise,w=c.findIndex(m=>m.id===n.id||le(m.scopes)===r);return w>-1?c.splice(w,1,n):c.push(n),await this.storeSessions(c),this._onDidChangeSessions.fire({added:[n],removed:[],changed:[]}),O.debug(`Created session for scopes=${r||"<all>"}`),n}catch(o){throw o==="Cancelled"||(l.window.showErrorMessage(`Unable to sign in: ${o}`),O.error(o)),o}}async getSessions(e){e=e==null?void 0:e.sort();const r=le(e);O.debug(`Getting sessions for scopes=${r||"all"}...`);const o=await this._sessionsPromise,n=e!=null?o.filter(c=>le(c.scopes)===r):o;return O.debug(`Found ${n.length} sessions for scopes=${r||"<all>"}`),n}async removeSession(e){O.log(`Removing session ${e}...`);try{const r=await this._sessionsPromise,o=r.findIndex(c=>c.id===e);if(o===-1){O.log(`Unable to remove session ${e}; Not found`);return}const n=r[o];r.splice(o,1),await this.storeSessions(r),this._onDidChangeSessions.fire({added:[],removed:[n],changed:[]})}catch(r){throw l.window.showErrorMessage(`Unable to sign out: ${r}`),O.error(r),r}}async checkForUpdates(){const e=await this._sessionsPromise;this._sessionsPromise=this.getSessionsFromStorage();const r=await this._sessionsPromise,o=[],n=[];for(const c of r)e.some(w=>w.id===c.id)||o.push(c);for(const c of e)r.some(w=>w.id===c.id)||n.push(c);(o.length||n.length)&&(O.debug(`Triggering sessions change notifications; added=${o.length}, removed=${n.length}`),this._onDidChangeSessions.fire({added:o,removed:n,changed:[]}))}async createSessionForToken(e,r){const o=await this.server.getAccountInfo(e);return{id:_(),accessToken:e,account:{label:o.accountName,id:o.id},scopes:r}}async getSessionsFromStorage(){let e;try{O.debug("Reading sessions from storage...");const n=await this.context.secrets.get(ue);if(!n||n==="[]")return[];O.debug("Found stored sessions");try{e=JSON.parse(n)}catch(c){try{await this.context.secrets.delete(ue)}catch{}throw c}}catch(n){return O.error(n,"Unable to read sessions"),[]}const r=e.map(async n=>{var c;const w=le(n.scopes);O.debug(`Read session from storage with scopes=${w}`);let m;if(n.account==null)try{m=await this.server.getAccountInfo(n.accessToken),O.debug(`Verified session with scopes=${w}`)}catch(S){if(S.message==="Unauthorized")return}return{id:n.id,account:{label:n.account!=null?n.account.label??n.account.displayName??"<unknown>":(m==null?void 0:m.accountName)??"<unknown>",id:((c=n.account)==null?void 0:c.id)??(m==null?void 0:m.id)??"<unknown>"},scopes:n.scopes,accessToken:n.accessToken}}),o=(await Promise.allSettled(r)).filter(n=>n.status==="fulfilled").map(n=>n.value).filter(n=>Boolean(n));return O.debug(`Found ${o.length} verified sessions`),o.length!==e.length&&await this.storeSessions(o),o}async storeSessions(e){O.debug(`Storing ${e.length} sessions...`),this._sessionsPromise=Promise.resolve(e),await this.context.secrets.store(ue,JSON.stringify(e)),O.debug(`Stored ${e.length} sessions`)}}function le(t){return t==null?void 0:t.join("|")}const k=require("stream"),Oe=require("http"),pe=require("url");var Ce=j(347);const Se=require("https"),Z=require("zlib"),ze=k.Readable,F=Symbol("buffer"),ve=Symbol("type");class ee{constructor(){this[ve]="";const e=arguments[0],r=arguments[1],o=[];let n=0;if(e){const w=e,m=Number(w.length);for(let S=0;S<m;S++){const C=w[S];let G;C instanceof Buffer?G=C:ArrayBuffer.isView(C)?G=Buffer.from(C.buffer,C.byteOffset,C.byteLength):C instanceof ArrayBuffer?G=Buffer.from(C):C instanceof ee?G=C[F]:G=Buffer.from(typeof C=="string"?C:String(C)),n+=G.length,o.push(G)}}this[F]=Buffer.concat(o);let c=r&&r.type!==void 0&&String(r.type).toLowerCase();c&&!/[^\u0020-\u007E]/.test(c)&&(this[ve]=c)}get size(){return this[F].length}get type(){return this[ve]}text(){return Promise.resolve(this[F].toString())}arrayBuffer(){const e=this[F],r=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(r)}stream(){const e=new ze;return e._read=function(){},e.push(this[F]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,r=arguments[0],o=arguments[1];let n,c;r===void 0?n=0:r<0?n=Math.max(e+r,0):n=Math.min(r,e),o===void 0?c=e:o<0?c=Math.max(e+o,0):c=Math.min(o,e);const w=Math.max(c-n,0),S=this[F].slice(n,n+w),C=new ee([],{type:arguments[2]});return C[F]=S,C}}Object.defineProperties(ee.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(ee.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0});function $(t,e,r){Error.call(this,t),this.message=t,this.type=e,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}$.prototype=Object.create(Error.prototype),$.prototype.constructor=$,$.prototype.name="FetchError";let de;try{de=require("encoding").convert}catch{}const q=Symbol("Body internals"),Ae=k.PassThrough;function v(t){var e=this,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.size;let n=o===void 0?0:o;var c=r.timeout;let w=c===void 0?0:c;t==null?t=null:Le(t)?t=Buffer.from(t.toString()):s(t)||Buffer.isBuffer(t)||(Object.prototype.toString.call(t)==="[object ArrayBuffer]"?t=Buffer.from(t):ArrayBuffer.isView(t)?t=Buffer.from(t.buffer,t.byteOffset,t.byteLength):t instanceof k||(t=Buffer.from(String(t)))),this[q]={body:t,disturbed:!1,error:null},this.size=n,this.timeout=w,t instanceof k&&t.on("error",function(m){const S=m.name==="AbortError"?m:new $(`Invalid response body while trying to fetch ${e.url}: ${m.message}`,"system",m);e[q].error=S})}v.prototype={get body(){return this[q].body},get bodyUsed(){return this[q].disturbed},arrayBuffer(){return te.call(this).then(function(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)})},blob(){let t=this.headers&&this.headers.get("content-type")||"";return te.call(this).then(function(e){return Object.assign(new ee([],{type:t.toLowerCase()}),{[F]:e})})},json(){var t=this;return te.call(this).then(function(e){try{return JSON.parse(e.toString())}catch(r){return v.Promise.reject(new $(`invalid json response body at ${t.url} reason: ${r.message}`,"invalid-json"))}})},text(){return te.call(this).then(function(t){return t.toString()})},buffer(){return te.call(this)},textConverted(){var t=this;return te.call(this).then(function(e){return je(e,t.headers)})}},Object.defineProperties(v.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),v.mixIn=function(t){for(const e of Object.getOwnPropertyNames(v.prototype))if(!(e in t)){const r=Object.getOwnPropertyDescriptor(v.prototype,e);Object.defineProperty(t,e,r)}};function te(){var t=this;if(this[q].disturbed)return v.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[q].disturbed=!0,this[q].error)return v.Promise.reject(this[q].error);let e=this.body;if(e===null)return v.Promise.resolve(Buffer.alloc(0));if(s(e)&&(e=e.stream()),Buffer.isBuffer(e))return v.Promise.resolve(e);if(!(e instanceof k))return v.Promise.resolve(Buffer.alloc(0));let r=[],o=0,n=!1;return new v.Promise(function(c,w){let m;t.timeout&&(m=setTimeout(function(){n=!0,w(new $(`Response timeout while trying to fetch ${t.url} (over ${t.timeout}ms)`,"body-timeout"))},t.timeout)),e.on("error",function(S){S.name==="AbortError"?(n=!0,w(S)):w(new $(`Invalid response body while trying to fetch ${t.url}: ${S.message}`,"system",S))}),e.on("data",function(S){if(!(n||S===null)){if(t.size&&o+S.length>t.size){n=!0,w(new $(`content size at ${t.url} over limit: ${t.size}`,"max-size"));return}o+=S.length,r.push(S)}}),e.on("end",function(){if(!n){clearTimeout(m);try{c(Buffer.concat(r,o))}catch(S){w(new $(`Could not create Buffer from response body for ${t.url}: ${S.message}`,"system",S))}}})})}function je(t,e){if(typeof de!="function")throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=e.get("content-type");let o="utf-8",n,c;return r&&(n=/charset=([^;]*)/i.exec(r)),c=t.slice(0,1024).toString(),!n&&c&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(c)),!n&&c&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(c),n||(n=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(c),n&&n.pop()),n&&(n=/charset=(.*)/i.exec(n.pop()))),!n&&c&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(c)),n&&(o=n.pop(),(o==="gb2312"||o==="gbk")&&(o="gb18030")),de(t,"UTF-8",o).toString()}function Le(t){return typeof t!="object"||typeof t.append!="function"||typeof t.delete!="function"||typeof t.get!="function"||typeof t.getAll!="function"||typeof t.has!="function"||typeof t.set!="function"?!1:t.constructor.name==="URLSearchParams"||Object.prototype.toString.call(t)==="[object URLSearchParams]"||typeof t.sort=="function"}function s(t){return typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&typeof t.constructor.name=="string"&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag])}function i(t){let e,r,o=t.body;if(t.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof k&&typeof o.getBoundary!="function"&&(e=new Ae,r=new Ae,o.pipe(e),o.pipe(r),t[q].body=e,o=r),o}function u(t){return t===null?null:typeof t=="string"?"text/plain;charset=UTF-8":Le(t)?"application/x-www-form-urlencoded;charset=UTF-8":s(t)?t.type||null:Buffer.isBuffer(t)||Object.prototype.toString.call(t)==="[object ArrayBuffer]"||ArrayBuffer.isView(t)?null:typeof t.getBoundary=="function"?`multipart/form-data;boundary=${t.getBoundary()}`:t instanceof k?null:"text/plain;charset=UTF-8"}function h(t){const e=t.body;return e===null?0:s(e)?e.size:Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&(e._lengthRetrievers&&e._lengthRetrievers.length==0||e.hasKnownLength&&e.hasKnownLength())?e.getLengthSync():null}function d(t,e){const r=e.body;r===null?t.end():s(r)?r.stream().pipe(t):Buffer.isBuffer(r)?(t.write(r),t.end()):r.pipe(t)}v.Promise=global.Promise;const P=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,L=/[^\t\x20-\x7e\x80-\xff]/;function I(t){if(t=`${t}`,P.test(t)||t==="")throw new TypeError(`${t} is not a legal HTTP header name`)}function D(t){if(t=`${t}`,L.test(t))throw new TypeError(`${t} is not a legal HTTP header value`)}function Y(t,e){e=e.toLowerCase();for(const r in t)if(r.toLowerCase()===e)return r}const R=Symbol("map");class M{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;if(this[R]=Object.create(null),e instanceof M){const r=e.raw(),o=Object.keys(r);for(const n of o)for(const c of r[n])this.append(n,c);return}if(e!=null)if(typeof e=="object"){const r=e[Symbol.iterator];if(r!=null){if(typeof r!="function")throw new TypeError("Header pairs must be iterable");const o=[];for(const n of e){if(typeof n!="object"||typeof n[Symbol.iterator]!="function")throw new TypeError("Each header pair must be iterable");o.push(Array.from(n))}for(const n of o){if(n.length!==2)throw new TypeError("Each header pair must be a name/value tuple");this.append(n[0],n[1])}}else for(const o of Object.keys(e)){const n=e[o];this.append(o,n)}}else throw new TypeError("Provided initializer must be an object")}get(e){e=`${e}`,I(e);const r=Y(this[R],e);return r===void 0?null:this[R][r].join(", ")}forEach(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,o=He(this),n=0;for(;n<o.length;){var c=o[n];const w=c[0],m=c[1];e.call(r,m,w,this),o=He(this),n++}}set(e,r){e=`${e}`,r=`${r}`,I(e),D(r);const o=Y(this[R],e);this[R][o!==void 0?o:e]=[r]}append(e,r){e=`${e}`,r=`${r}`,I(e),D(r);const o=Y(this[R],e);o!==void 0?this[R][o].push(r):this[R][e]=[r]}has(e){return e=`${e}`,I(e),Y(this[R],e)!==void 0}delete(e){e=`${e}`,I(e);const r=Y(this[R],e);r!==void 0&&delete this[R][r]}raw(){return this[R]}keys(){return Me(this,"key")}values(){return Me(this,"value")}[Symbol.iterator](){return Me(this,"key+value")}}M.prototype.entries=M.prototype[Symbol.iterator],Object.defineProperty(M.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(M.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});function He(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"key+value";return Object.keys(t[R]).sort().map(e==="key"?function(o){return o.toLowerCase()}:e==="value"?function(o){return t[R][o].join(", ")}:function(o){return[o.toLowerCase(),t[R][o].join(", ")]})}const qe=Symbol("internal");function Me(t,e){const r=Object.create(Ge);return r[qe]={target:t,kind:e,index:0},r}const Ge=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==Ge)throw new TypeError("Value of `this` is not a HeadersIterator");var t=this[qe];const e=t.target,r=t.kind,o=t.index,n=He(e,r),c=n.length;return o>=c?{value:void 0,done:!0}:(this[qe].index=o+1,{value:n[o],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(Ge,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});function at(t){const e=Object.assign({__proto__:null},t[R]),r=Y(t[R],"Host");return r!==void 0&&(e[r]=e[r][0]),e}function ut(t){const e=new M;for(const r of Object.keys(t))if(!P.test(r))if(Array.isArray(t[r]))for(const o of t[r])L.test(o)||(e[R][r]===void 0?e[R][r]=[o]:e[R][r].push(o));else L.test(t[r])||(e[R][r]=[t[r]]);return e}const re=Symbol("Response internals"),lt=Oe.STATUS_CODES;class W{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};v.call(this,e,r);const o=r.status||200,n=new M(r.headers);if(e!=null&&!n.has("Content-Type")){const c=u(e);c&&n.append("Content-Type",c)}this[re]={url:r.url,status:o,statusText:r.statusText||lt[o],headers:n,counter:r.counter}}get url(){return this[re].url||""}get status(){return this[re].status}get ok(){return this[re].status>=200&&this[re].status<300}get redirected(){return this[re].counter>0}get statusText(){return this[re].statusText}get headers(){return this[re].headers}clone(){return new W(i(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}v.mixIn(W.prototype),Object.defineProperties(W.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(W.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const Q=Symbol("Request internals"),ht=pe.URL||Ce.URL,ft=pe.parse,ct=pe.format;function We(t){return/^[a-zA-Z][a-zA-Z\d+\-.]*:/.exec(t)&&(t=new ht(t).toString()),ft(t)}const pt="destroy"in k.Readable.prototype;function Te(t){return typeof t=="object"&&typeof t[Q]=="object"}function dt(t){const e=t&&typeof t=="object"&&Object.getPrototypeOf(t);return!!(e&&e.constructor.name==="AbortSignal")}class he{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o;Te(e)?o=We(e.url):(e&&e.href?o=We(e.href):o=We(`${e}`),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(r.body!=null||Te(e)&&e.body!==null)&&(n==="GET"||n==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let c=r.body!=null?r.body:Te(e)&&e.body!==null?i(e):null;v.call(this,c,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const w=new M(r.headers||e.headers||{});if(c!=null&&!w.has("Content-Type")){const S=u(c);S&&w.append("Content-Type",S)}let m=Te(e)?e.signal:null;if("signal"in r&&(m=r.signal),m!=null&&!dt(m))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[Q]={method:n,redirect:r.redirect||e.redirect||"follow",headers:w,parsedURL:o,signal:m},this.follow=r.follow!==void 0?r.follow:e.follow!==void 0?e.follow:20,this.compress=r.compress!==void 0?r.compress:e.compress!==void 0?e.compress:!0,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[Q].method}get url(){return ct(this[Q].parsedURL)}get headers(){return this[Q].headers}get redirect(){return this[Q].redirect}get signal(){return this[Q].signal}clone(){return new he(this)}}v.mixIn(he.prototype),Object.defineProperty(he.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(he.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});function gt(t){const e=t[Q].parsedURL,r=new M(t[Q].headers);if(r.has("Accept")||r.set("Accept","*/*"),!e.protocol||!e.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(e.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(t.signal&&t.body instanceof k.Readable&&!pt)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(t.body==null&&/^(POST|PUT)$/i.test(t.method)&&(o="0"),t.body!=null){const c=h(t);typeof c=="number"&&(o=String(c))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let n=t.agent;return typeof n=="function"&&(n=n(e)),!r.has("Connection")&&!n&&r.set("Connection","close"),Object.assign({},e,{method:t.method,headers:at(r),agent:n})}function Pe(t){Error.call(this,t),this.type="aborted",this.message=t,Error.captureStackTrace(this,this.constructor)}Pe.prototype=Object.create(Error.prototype),Pe.prototype.constructor=Pe,Pe.prototype.name="AbortError";const Je=pe.URL||Ce.URL,Ve=k.PassThrough,mt=function(e,r){const o=new Je(r).hostname,n=new Je(e).hostname;return o===n||o[o.length-n.length-1]==="."&&o.endsWith(n)};function se(t,e){if(!se.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return v.Promise=se.Promise,new se.Promise(function(r,o){const n=new he(t,e),c=gt(n),w=(c.protocol==="https:"?Se:Oe).request,m=n.signal;let S=null;const C=function(){let ne=new Pe("The user aborted a request.");o(ne),n.body&&n.body instanceof k.Readable&&n.body.destroy(ne),!(!S||!S.body)&&S.body.emit("error",ne)};if(m&&m.aborted){C();return}const G=function(){C(),ie()},Ee=w(c);let Ye;m&&m.addEventListener("abort",G);function ie(){Ee.abort(),m&&m.removeEventListener("abort",G),clearTimeout(Ye)}n.timeout&&Ee.once("socket",function(N){Ye=setTimeout(function(){o(new $(`network timeout at: ${n.url}`,"request-timeout")),ie()},n.timeout)}),Ee.on("error",function(N){o(new $(`request to ${n.url} failed, reason: ${N.message}`,"system",N)),ie()}),Ee.on("response",function(N){clearTimeout(Ye);const ne=ut(N.headers);if(se.isRedirect(N.statusCode)){const Be=ne.get("Location");let oe=null;try{oe=Be===null?null:new Je(Be,n.url).toString()}catch{if(n.redirect!=="manual"){o(new $(`uri requested responds with an invalid redirect URL: ${Be}`,"invalid-redirect")),ie();return}}switch(n.redirect){case"error":o(new $(`uri requested responds with a redirect, redirect mode is set to error: ${n.url}`,"no-redirect")),ie();return;case"manual":if(oe!==null)try{ne.set("Location",oe)}catch(Qe){o(Qe)}break;case"follow":if(oe===null)break;if(n.counter>=n.follow){o(new $(`maximum redirect reached at: ${n.url}`,"max-redirect")),ie();return}const me={headers:new M(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:n.body,signal:n.signal,timeout:n.timeout,size:n.size};if(!mt(n.url,oe))for(const Qe of["authorization","www-authenticate","cookie","cookie2"])me.headers.delete(Qe);if(N.statusCode!==303&&n.body&&h(n)===null){o(new $("Cannot follow redirect with body being a readable stream","unsupported-redirect")),ie();return}(N.statusCode===303||(N.statusCode===301||N.statusCode===302)&&n.method==="POST")&&(me.method="GET",me.body=void 0,me.headers.delete("content-length")),r(se(new he(oe,me))),ie();return}}N.once("end",function(){m&&m.removeEventListener("abort",G)});let z=N.pipe(new Ve);const Ue={url:n.url,status:N.statusCode,statusText:N.statusMessage,headers:ne,size:n.size,timeout:n.timeout,counter:n.counter},ge=ne.get("Content-Encoding");if(!n.compress||n.method==="HEAD"||ge===null||N.statusCode===204||N.statusCode===304){S=new W(z,Ue),r(S);return}const At={flush:Z.Z_SYNC_FLUSH,finishFlush:Z.Z_SYNC_FLUSH};if(ge=="gzip"||ge=="x-gzip"){z=z.pipe(Z.createGunzip(At)),S=new W(z,Ue),r(S);return}if(ge=="deflate"||ge=="x-deflate"){N.pipe(new Ve).once("data",function(oe){(oe[0]&15)===8?z=z.pipe(Z.createInflate()):z=z.pipe(Z.createInflateRaw()),S=new W(z,Ue),r(S)});return}if(ge=="br"&&typeof Z.createBrotliDecompress=="function"){z=z.pipe(Z.createBrotliDecompress()),S=new W(z,Ue),r(S);return}S=new W(z,Ue),r(S)}),d(Ee,n)})}se.isRedirect=function(t){return t===301||t===302||t===303||t===307||t===308},se.Promise=global.Promise;const bt=se,yt=(t,e)=>e(t);function wt(t,e=yt){let r,o;return{promise:new Promise((c,w)=>{r=()=>{r=void 0,w()},o=t(async m=>{try{await e(m,c,w)}catch(S){w(S)}})}).then(c=>(o.dispose(),c),c=>{throw o.dispose(),c}),cancel:()=>r==null?void 0:r()}}function et(t,e){return t===""||e==null?e:e instanceof Error?String(e):e instanceof l.Uri?"sha"in e&&e.sha?`${e.sha}:${e.toString()}`:e.toString():e}function tt(...t){if(t.length===0)return"";if(t.length!==1)return JSON.stringify(t,et);const e=t[0];return e==null?"":typeof e=="string"?e:typeof e=="number"||typeof e=="boolean"||e instanceof Error?String(e):e instanceof l.Uri?"sha"in e&&e.sha?`${e.sha}:${e.toString()}`:e.toString():JSON.stringify(e,et)}function St(t,e,...r){if(r.length===0)return t;let o;if(e!=null)try{o=e(...r)}catch{o=tt(...r)}else o=tt(...r);return`${t}$${o}`}function rt(t){return(e,r,o)=>{let n,c;if(typeof o.value=="function")n=o.value,c="value";else if(typeof o.get=="function")n=o.get,c="get";else throw new Error("Not supported");if(n==null)throw new Error("Not supported");const w=`$memoize$${r}`;let m;o[c]=function(...S){const C=St(w,t,...S);return Object.prototype.hasOwnProperty.call(this,C)?(m=this[C],m):(m=n.apply(this,S),Object.defineProperty(this,C,{configurable:!1,enumerable:!1,writable:!1,value:m}),m)}}}var st=Object.defineProperty,vt=Object.getOwnPropertyDescriptor,Pt=(t,e,r)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,it=(t,e,r,o)=>{for(var n=o>1?void 0:o?vt(e,r):e,c=t.length-1,w;c>=0;c--)(w=t[c])&&(n=(o?w(e,r,n):w(n))||n);return o&&n&&st(e,r,n),n},xe=(t,e,r)=>(Pt(t,typeof e!="symbol"?e+"":e,r),r);class Ke{constructor(e,r){this.context=e,this.env=r,xe(this,"_deferredCodeExchanges",new Map),xe(this,"_disposable"),xe(this,"_pendingStates",new Map),xe(this,"_statusBarItem"),xe(this,"_uriHandler",new xt),this._disposable=l.Disposable.from(l.window.registerUriHandler(this._uriHandler))}dispose(){this._disposable.dispose()}get baseApiUri(){return this.env==="staging"?l.Uri.parse("https://stagingapi.gitkraken.com"):this.env==="dev"?l.Uri.parse("https://devapi.gitkraken.com"):l.Uri.parse("https://api.gitkraken.com")}get baseAccountUri(){return this.env==="staging"?l.Uri.parse("https://stagingaccount.gitkraken.com"):this.env==="dev"?l.Uri.parse("https://devaccount.gitkraken.com"):l.Uri.parse("https://account.gitkraken.com")}async getAccountInfo(e){O.debug("Getting account info for token...");let r;try{r=await bt(l.Uri.joinPath(this.baseApiUri,"user").toString(),{headers:{Authorization:`Bearer ${e}`,"User-Agent":"Visual-Studio-Code"}})}catch(n){throw O.error(n),n}if(!r.ok)throw O.error(void 0,`Getting account info failed: ${r.statusText}`),new Error(r.statusText);const o=await r.json();return O.debug("Got the account info"),{id:o.id,accountName:o.username}}async login(e,r){O.log(`Logging in for scopes=${r}...`),this.updateStatusBarItem(!0);const o=_(),n=this._pendingStates.get(r)??[];this._pendingStates.set(r,[...n,o]);const c=await l.env.asExternalUri(l.Uri.parse(`${l.env.uriScheme}://${this.context.extension.id}/did-authenticate?gkstate=${o}`)),w=l.Uri.joinPath(this.baseAccountUri,"register").with({query:`${e.includes("gitlens")?"referrer=gitlens&":""}pass-token=true&return-url=${encodeURIComponent(c.toString())}`});await l.env.openExternal(w);let m=this._deferredCodeExchanges.get(r);return m==null&&(m=wt(this._uriHandler.event,this.getUriHandlerDeferredExecutor(r)),this._deferredCodeExchanges.set(r,m)),Promise.race([m.promise,new Promise((S,C)=>setTimeout(()=>C("Cancelled"),6e4))]).finally(()=>{this._pendingStates.delete(r),m==null||m.cancel(),this._deferredCodeExchanges.delete(r),this.updateStatusBarItem(!1)})}getUriHandlerDeferredExecutor(e){return(r,o,n)=>{const c=Et(r),w=this._pendingStates.get(e);if(w==null||!w.includes(c.gkstate)){O.log("State not found in accepted state. Skipping this execution...");return}const m=c["access-token"];m==null?n("Token not returned"):o(m)}}updateStatusBarItem(e){e&&this._statusBarItem==null&&(this._statusBarItem=l.window.createStatusBarItem("gitkraken-authentication.signIn",l.StatusBarAlignment.Left),this._statusBarItem.name="GitKraken Sign-in",this._statusBarItem.text="Signing into gitkraken.com...",this._statusBarItem.show()),!e&&this._statusBarItem!=null&&(this._statusBarItem.dispose(),this._statusBarItem=void 0)}}it([rt()],Ke.prototype,"baseApiUri",1),it([rt()],Ke.prototype,"baseAccountUri",1);class xt extends l.EventEmitter{handleUri(e){O.log("Handling authentication callback..."),this.fire(e)}}function Et(t){return t.query.split("&").reduce((e,r)=>{const o=r.split("=");return e[o[0]]=o[1],e},{})}var Ut=Object.defineProperty,_t=(t,e,r)=>e in t?Ut(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ze=(t,e,r)=>(_t(t,typeof e!="symbol"?e+"":e,r),r);const X="gitkraken-authentication";class nt{constructor(){Ze(this,"_onDidChange",new l.EventEmitter),Ze(this,"_onDidChangeAny",new l.EventEmitter),Ze(this,"_onWillChange",new l.EventEmitter)}static configure(e){e.subscriptions.push(l.workspace.onDidChangeConfiguration(Re.onConfigurationChanged,Re))}get onDidChange(){return this._onDidChange.event}get onDidChangeAny(){return this._onDidChangeAny.event}get onWillChange(){return this._onWillChange.event}onConfigurationChanged(e){if(!e.affectsConfiguration(X)){this._onDidChangeAny.fire(e);return}const r={change:e};this._onWillChange.fire(r),r.transform!==void 0&&(e=r.transform(e)),this._onDidChangeAny.fire(e),this._onDidChange.fire(e)}get(e,r,o){return o===void 0?l.workspace.getConfiguration(e===void 0?void 0:X,r).get(e===void 0?X:e):l.workspace.getConfiguration(e===void 0?void 0:X,r).get(e===void 0?X:e,o)}getAny(e,r,o){return o===void 0?l.workspace.getConfiguration(void 0,r).get(e):l.workspace.getConfiguration(void 0,r).get(e,o)}changed(e,r,o){return(e==null?void 0:e.affectsConfiguration(`${X}.${r}`,o))??!0}inspect(e,r){return l.workspace.getConfiguration(e===void 0?void 0:X,r).inspect(e===void 0?X:e)}inspectAny(e,r){return l.workspace.getConfiguration(void 0,r).inspect(e)}name(e){return e}update(e,r,o){return l.workspace.getConfiguration(X).update(e,r,o)}updateAny(e,r,o,n){return l.workspace.getConfiguration(void 0,o===l.ConfigurationTarget.Global?void 0:n).update(e,r,o)}}const Re=new nt;function Ot(t){nt.configure(t),O.configure(t,Re.get("logLevel"));const e=Ct(),r=new Ke(t,e);t.subscriptions.push(r,new K(t,r)),O.log(`GitKraken Auth Provider v${t.extension.packageJSON.version} activating in ${l.env.appName}(${l.version}) on the ${l.env.uiKind===l.UIKind.Web?"web":"desktop"}${e!=="production"?`: env: (${e})`:""}`)}function Ct(){const t=Re.getAny("gitkraken.env");return t==="dev"?"dev":t==="staging"?"staging":"production"}})(),module.exports=$e})();
